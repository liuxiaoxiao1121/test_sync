version: "1.5"

stages:
  - Parallel ACI
  - 发布github

onlyExecuteLastPipeline: true #同一个分支只执行一个ci

only:
  triggerType:
    - pullRequest # 创建 PR
    - push
    - tagPush

stc安全扫描:
  stage: Parallel ACI
  component: stc

python代码检查:
  stage: Parallel ACI
  component: python-sast
  config:
    execute:
      timeout: 600
      isAllowSkip: true
    afterExecute:
      checkRule:
        - ${{outputs.critical}} <= 300

antc_发布依赖包:
  stage: 发布github
  component: shell-with-clone-and-output
  inputs:
    script: |
      ant_token=${{secrets.ant_token}}
      source=${{vcs.pullRequestSourceBranch}}
      commitId=${{vcs.commitSha}}
      add_output output "${commitId}"